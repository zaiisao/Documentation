
---
title: 视频相关
description: 
platform: All Platforms
updatedAt: Thu Nov 29 2018 06:55:01 GMT+0800 (CST)
---
# 视频相关
## 卡顿
视频卡顿问题一般由网络、设备性能等原因造成，请按以下步骤进行排查：

* 判断是持续性的还是一次性的卡顿。后者是由网络和设备的随机性导致，属于正常现象；
* 检查网络状态，判断连接是否正常，是否能够上网；
* 如果网络连接正常但依然卡顿，请尝试 4G 连接或其他 WiFi 信号，找到网络状态良好的条件下情况如何；
* 如果网络良好且条件允许，请尝试更换设备；
* 如果有视频前处理，例如美颜等，请先关闭前处理，确保卡顿不是由于前处理导致的。

如果上述措施没有解决问题，请收集下面信息并联系技术支持：

* 卡顿用户的 UID，如果是直播场景，需要提供这个卡顿是来自于主播还是连麦嘉宾；
* 卡顿的具体时间段；
* 如果频道中有语音，检查语音是否流畅、清晰；
* 卡顿用户的 SDK 日志及录屏文件。

你可以使用 Agora Dashboard 的[水晶球](http://dashboard.agora.io/analytics/call/search)功能对通话质量进行跟踪和反馈，详见[水晶球教程](https://dashboard.agora.io/analytics/call/tutorial?_ga=2.197716463.1125435494.1542623251-764614247.1539586349)。

## 模糊
视频模糊一般是由视频码率或分辨率过低导致，请按以下步骤进行排查：

* 确认 `videoProfile` 设置，如果可以的话，尝试更高的 profile 看是否可以解决问题；
* 看看接收端接受的是大流还是小流，是小流的话可以调用接口申请大流关闭小流；
* 尝试 4G 连接，或者其他 WiFi 信号排除网络问题；
* 如果有视频前处理，请先关闭前处理； 

如果上述措施没有解决问题，请联系技术支持并提供下列信息：

* 出现模糊画面的用户的 UID；
* 模糊的具体时间端；
* 出现问题的用户的 SDK 日志及录屏文件。

你可以使用 Agora Dashboard 的[水晶球](http://dashboard.agora.io/analytics/call/search)功能对通话质量进行跟踪和反馈，详见[水晶球教程](https://dashboard.agora.io/analytics/call/tutorial?_ga=2.197716463.1125435494.1542623251-764614247.1539586349)。

## 黑屏
可能出现黑屏的原因有很多，其中两个最重要的原因是：

* 网络问题：如果本地网络连接很差或者中断，就会看不到其他用户的视频。如果通话中有一方的网络出现问题，其他人也看不到这个用户的视频。
* 用户主动关闭了视频，也会出现黑屏。

黑屏主要有以下三种情况：

**本地视频黑屏远端视频正常**

这种情况一般是摄像头故障或者被占用等原因导致本地视频采集出现问题，请按以下步骤排查：

* 摄像头硬件问题。打开系统自带的拍摄视频程序看是否可以录像，如果不行，需要换摄像头；
* 如果摄像头没有问题，看下摄像头权限有没有打开。Android 和 iOS 系统都有权限管理，请在系统设置中检查，同时 Android 上有些安全软件也管理权限；
* 是否有其他应用占据了摄像头。关闭其他应用然后打开我们的应用测试；重启手机再测试；
* 检查是否是用户禁用了本地视频；
* 如果是自采集，需要确认外部采集数据是否有问题。

**本地视频正常远端视频黑屏**

这种情况可能是远端采集问题或者本地下行网络原因导致，请按以下步骤排查：

* 检查用户是否禁用了远端视频；
* 如果没有禁用远端视频，建议换4G网络看下是否还存在问题来排除网络原因。

**本地远端视频都黑屏**

这种情况可能是渲染出现问题或者没有启用视频，请按以下步骤排查：

* 检查是否有调用 `enableVideo` 方法启用视频；
* 检查是否有禁用本地及远端视频；
* 如果上述都没有问题，可能是渲染问题，Windows 端检查 SDK 日志，看渲染方式（render type）是什么。如果是 D2D 渲染，很可能是显卡驱动不是最新，建议去显卡官网更新显卡至最新版。如果更新完官方驱动还是不行，建议走设置 GDI 渲染方式，即加入频道前调用下面的方法：
   * AParameter apm(*pRTCEngine);
   * nRet = apm->setInt("che.video.renderer.type", 9);
* 如果是自渲染，需要确认渲染方式是否有问题。

如果按照上述步骤没有解决问题，请收集下面的信息并联系技术支持：

* 已经做过的排查步骤及结果；
* 黑屏用户的 UID；
* 黑屏的具体时间段；
* 出现问题端用户的 SDK 日志。

## 镜像
如果远端看到镜像的视频：检查 App 是否调用了 `setParameters`(audioEngine.remoteVideoMirroring)。
如果是本地预览发生镜像：

* 手机的前置摄像头就是镜像的，属于正常现象；
* 其他情况发生镜像，检查 App 是否调用了 `setParameters`(che.video.localViewMirrorSetting)。

如果镜像问题不属于上述情况，请联系技术支持并提供下列信息：

* 使用了哪个摄像头，是本地预览镜像了还是远端镜像了；
* 希望是镜像效果还是非镜像效果。

## 无法打开摄像头
摄像头打开失败有多种原因，请按以下步骤检查：

1. 确认摄像头权限有没有打开。Android 和 iOS 系统都有权限管理，请在系统设置中检查。同时 Android 上有些安全软件也管理权限。
2. 检查是否有其他应用占据了摄像头。关闭其他应用，重启手机再试。
3. 摄像头硬件问题。打开系统自带的拍摄视频程序看是否可以录像。

## 显示大头/黑边
这种情况一般是由于视频尺寸与显示视窗尺寸不一致，有下面几种情况：

* 如果是视频宽高和摄像头输出不一致，会在编码前发生裁剪导致视频放大；
* 如果接收端渲染使用的是 hidden 模式，并且视频尺寸与显示视窗尺寸不一致时，会发生裁剪导致视频放大；
* 如果接收端渲染使用的是 fit 模式，并且视频尺寸与显示视窗尺寸不一致时，会发生缩放导致黑边。

如果排除上述几种情况后问题仍存在，请联系技术支持并提供下列信息：

* 发送方的 SDK 日志；
* 发送方如果是手机，检查发送方是横屏还是竖屏；
* 接收方的窗口长宽比。

